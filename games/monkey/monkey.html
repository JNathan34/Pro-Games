<!-- Ultimate Game Stash file--> 
<!doctype html>
<html lang="en">

<head>
	<base href="https://cdn.jsdelivr.net/gh/genizy/monkey-mart-mobile@89836e4c54e87739ace84f6fe801b423185cc51d/">
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="robots" content="noindex, nofollow">
	<meta name="viewport"
		content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, minimal-ui, shrink-to-fit=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<title>Monkey Mart</title>

	<style>
		/* FIXED: removed position: fixed (breaks Defold input) */
		body {
			margin: 0;
			padding: 0;
			overflow: hidden;
			touch-action: none;
			background-color: #ffffff;
		}

		.canvas-app-container {
			width: 100%;
			height: 100%;
			position: absolute;
			align-items: center;
			justify-content: center;
			overflow: hidden;
			background: #00BB61;
		}

		#canvas {
			outline: none;
			border: 0;
			width: 100%;
			vertical-align: bottom;
		}

		.canvas-app-canvas {
			background-repeat: no-repeat;
			background-position: top;
			background-size: cover;
			background-image: url("bg_loading.png");
		}

		.buttons-background {
			background-color: #ffffff;
			width: 100%;
			height: 42px;
		}

		.banner-styleBottom,
		.banner-styleTop {
			margin: 0 auto;
			position: fixed;
			display: block;
			left: 50%;
			transform: translateX(-50%);
		}

		.banner-styleBottom {
			bottom: 0;
		}

		.banner-styleTop {
			top: 0;
		}
	</style>

	<script src="patch/js/poki-sdk.js"></script>
</head>

<body>

	<div id="app-container" class="canvas-app-container">
		<div id="canvas-container" class="canvas-app-canvas-container">
			<canvas id="canvas" class="canvas-app-canvas" tabindex="1" width="960" height="640"></canvas>
		</div>

		<div class="buttons-background"></div>

		<div id="progress-bar-root" style="position: absolute; bottom: 16%; left: 50%; visibility: hidden; z-index: 4;">
			<img id="progress-bar-bg" src="load_bar_bg.png">
			<img id="progress-bar-fg" src="load_bar_fg.png" style="position:absolute; clip: rect(0px,0px,0px,0px);">
		</div>
	</div>

	<script id="engine-loader" type="text/javascript" src="dmloader.js"></script>

	<script id="engine-setup" type="text/javascript">
		/* ORIGINAL ENGINE SETUP (unchanged) */
		var extra_params = {
			archive_location_filter: function (path) {
				return ("archive" + path + "");
			},
			engine_arguments: ["--verify-graphics-calls=false"],
			custom_heap_size: 134217728,
			full_screen_container: "#canvas-container",
			disable_context_menu: true
		};

		Module['INITIAL_MEMORY'] = extra_params.custom_heap_size;

		Module['onRuntimeInitialized'] = function () {
			Module.runApp("canvas", extra_params);
		};

		Module["locateFile"] = function (path, scriptDirectory) {
			if (path == "dmengine.wasm" || path == "dmengine_release.wasm" || path == "dmengine_headless.wasm") {
				path = "MonkeyMart.wasm";
			}
			return scriptDirectory + path;
		};

		var is_iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
		var buttonHeight = 0;
		var prevInnerWidth = -1;
		var prevInnerHeight = -1;

		function resize_game_canvas() {
			if (is_iOS) window.scrollTo(0, 0);

			var app_container = document.getElementById('app-container');
			var game_canvas = document.getElementById('canvas');
			var progress_bar_root = document.getElementById('progress-bar-root');
			var progress_bar_fg = document.getElementById('progress-bar-fg');
			var progress_bar_bg = document.getElementById('progress-bar-bg');

			var innerWidth = window.innerWidth;
			var innerHeight = window.innerHeight - buttonHeight;

			if (prevInnerWidth == innerWidth && prevInnerHeight == innerHeight) return;
			prevInnerWidth = innerWidth;
			prevInnerHeight = innerHeight;

			var width = innerWidth;
			var height = innerHeight;

			app_container.style.width = width + "px";
			app_container.style.height = height + buttonHeight + "px";
			game_canvas.width = width;
			game_canvas.height = height;

			var bar_h = Math.min(width, height);
			progress_bar_bg.width = Math.min(Math.ceil(bar_h * 0.06 * 300 / 24), width * 0.8);

			progress_bar_bg.style.marginLeft = - progress_bar_bg.width / 2 + "px";
			progress_bar_fg.width = Math.ceil(progress_bar_bg.width);

			progress_bar_fg.style.marginTop = "0px";
			progress_bar_fg.style.marginLeft = -progress_bar_bg.width / 2 - progress_bar_fg.width / 2 + "px";

			progress_bar_root.style.bottom = Math.ceil(height * 0.08 + buttonHeight) + "px";
		}

		resize_game_canvas();
		window.addEventListener('resize', resize_game_canvas, false);
		window.addEventListener('orientationchange', resize_game_canvas, false);
		window.addEventListener('focus', resize_game_canvas, false);
	</script>

	<script id="engine-start" type="text/javascript">
		/* ORIGINAL loader (unchanged) */
		var currentPercentage = 0;

		Progress.updateProgress = function (percentage) {
			Progress.notifyListeners(percentage);

			if (currentPercentage > percentage) {
				percentage = currentPercentage;
			}
			currentPercentage = percentage;

			var fg = document.getElementById('progress-bar-fg');
			fg.style.clip = "rect(0px," + fg.width * percentage / 100 + "px," + fg.height + "px,0px)";

			if (isNaN(percentage)) {
				document.getElementById('progress-bar-root').style.visibility = "hidden";
			}
		};

		Progress.addProgress = function () {
			document.getElementById('progress-bar-root').style.visibility = "visible";
		};

		Progress.removeProgress = function () {
			document.getElementById('progress-bar-root').style.visibility = "hidden";
			Module.canvas.style.background = "";
		};

		EngineLoader.stream_wasm = "false" === "true";
		EngineLoader.load("canvas", "MonkeyMart");
	</script>

	<script type="text/javascript" src="GameAnalytics.js"></script>

</body>
</html>
